# Implementation Plan

- [ ] 1. profiles テーブルのスキーマ定義とマイグレーション
  - Drizzle ORM でイミュータブルな profiles テーブルを定義する（年収・貯蓄額・想定金利・返済期間・頭金割合の5項目 + 自動採番 ID + 作成日時）
  - `updated_at` カラムは不要（イミュータブルパターンのため）
  - `created_at` 降順のインデックスを追加し、最新レコードの取得を最適化する
  - マイグレーションファイルを生成・適用し、ローカル PostgreSQL にテーブルを作成する
  - _Requirements: 5.1, 5.3_

- [ ] 2. (P) shadcn/ui コンポーネントのインストール
  - プロフィールフォームに必要な UI コンポーネント（Button, Input, Label, Card）を shadcn CLI でインストールする
  - インストール後、コンポーネントが正しく配置されていることを確認する
  - _Requirements: 1.1_

- [ ] 3. プロフィール API エンドポイント実装
- [ ] 3.1 プロフィール取得 API の実装
  - 最新の profiles レコードを `created_at` 降順で1件取得して返却するエンドポイントを作成する
  - レコードが存在しない場合は `null` を返す
  - DB カラム名（snake_case）から API レスポンス（camelCase）への変換を行う
  - _Requirements: 2.1, 5.2_

- [ ] 3.2 プロフィール保存 API の実装
  - リクエストボディを受け取り、バリデーション後に新規レコードとして INSERT するエンドポイントを作成する
  - サーバー側バリデーション: 数値型チェック、年収・貯蓄額は 0 以上、想定金利は 0〜20、返済期間は 1〜50、頭金割合は 0〜100
  - バリデーションエラー時はフィールド別のエラーメッセージを 400 で返却する
  - 既存レコードの UPDATE は行わない（イミュータブルパターン）
  - 保存成功時は挿入されたレコードを返却する
  - _Requirements: 1.2, 3.1, 4.1, 4.2, 5.1_

- [ ] 4. プロフィールフォームの実装
- [ ] 4.1 フォーム UI とクライアントバリデーション
  - 5つの財務項目の数値入力フィールドを持つフォームを作成する（年収・貯蓄額・想定金利・返済期間・頭金割合）
  - 各フィールドに単位ラベル（万円、%、年）を表示する
  - フィールド変更時にリアルタイムバリデーションを実行し、エラー時は該当フィールドの近くにメッセージを表示する
  - バリデーションエラーが存在する間は保存ボタンを無効化する
  - 初期データが渡された場合はフォームに値をセットし、未登録時は空フォームと初回登録を促すメッセージを表示する
  - _Requirements: 1.1, 2.2, 4.1, 4.2, 4.3, 4.4_

- [ ] 4.2 API 連携とフィードバック表示
  - 保存ボタン押下時にプロフィール保存 API を呼び出し、送信中は保存ボタンをローディング状態にする
  - 保存成功時にフィードバックメッセージを表示し、一定時間後に自動で消す
  - 保存失敗時はエラーメッセージを表示する
  - _Requirements: 1.2, 1.3, 3.1, 3.2_

- [ ] 5. プロフィールページの統合
  - Server Component で DB から最新のプロフィールレコードを直接取得し、フォームコンポーネントに渡すページを作成する
  - プロフィール未登録時は `null` を渡して空フォーム表示を実現する
  - ページにアクセスして、登録・表示・編集の一連のフローが正しく動作することを確認する
  - _Requirements: 2.1, 2.2, 5.2_
